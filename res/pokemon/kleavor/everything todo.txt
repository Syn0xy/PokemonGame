all of this is copied from klefki